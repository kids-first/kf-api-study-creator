

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Downloads &mdash; Kids First Study Creator  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Authentication" href="authentication.html" />
    <link rel="prev" title="Uploads" href="uploads.html" />
    <link rel="stylesheet" href="https://kids-first.github.io/kf-sphinx-docs-theme/sphinx_kidsfirst_theme/static/css/kidsfirst.css" type="text/css" />
 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/study_creator.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="development/quickstart.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="model.html">Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="uploads.html">Uploads</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Downloads</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#role-authorization">Role Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#direct-download-with-headers">Direct Download with Headers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#downloads-with-signed-urls">Downloads with Signed Urls</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-the-rest-endpoint">Using the REST Endpoint</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-a-graphql-mutation">Using a GraphQL Mutation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#downloads-with-developer-tokens">Downloads with Developer Tokens</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="authorization.html">Authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="cavatica.html">Cavatica Integration</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Kids First Study Creator</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Downloads</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/downloads.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="downloads">
<h1>Downloads<a class="headerlink" href="#downloads" title="Permalink to this headline">¶</a></h1>
<p>What good is an uploaded file if it cannot be retrieved?
The study creator authorizes download requests through role based permissions
and provides file downloads through two different mechanisms: typical JWT
authorization, and signed urls.</p>
<div class="section" id="role-authorization">
<h2>Role Authorization<a class="headerlink" href="#role-authorization" title="Permalink to this headline">¶</a></h2>
<p>There are three levels of file access following the three <a class="reference internal" href="authorization.html#user-types"><span class="std std-ref">User Types</span></a>.
Admin users are granted unrestricted access to download all files.
Authenticated users are restricted to downloading only files that are in a
study whose group the user belongs.
Unauthenticated users are not allowed to download any files.</p>
</div>
<div class="section" id="direct-download-with-headers">
<h2>Direct Download with Headers<a class="headerlink" href="#direct-download-with-headers" title="Permalink to this headline">¶</a></h2>
<p>To download a protected file using the standard JWT bearer tokens used
in the <cite>GraphQL</cite> endpoint, pass the same bearer token in the <cite>Authorization</cite>
header.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl -H <span class="s2">&quot;Authorization: Bearer </span><span class="nv">$token</span><span class="s2">&quot;</span> <span class="se">\</span>
    /download/study/SD_00000000/file/SF_00000000
</pre></div>
</div>
<p>This endpoint is fairly deterministic and based on the following route:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/download/study_id/&lt;study_id&gt;/file/&lt;file_id&gt;<span class="o">(</span>?P/version/&lt;version_id&gt;<span class="o">)</span>
</pre></div>
</div>
<p>Although this same url may be fetched from the file and version nodes as well:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>query fileUrls <span class="o">{</span>
  allFiles <span class="o">{</span>
    edges <span class="o">{</span>
      node <span class="o">{</span>
        downloadUrl
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

query versionUrls <span class="o">{</span>
  allVersions <span class="o">{</span>
    edges <span class="o">{</span>
      node<span class="o">{</span>
        downloadUrl
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="downloads-with-signed-urls">
<h2>Downloads with Signed Urls<a class="headerlink" href="#downloads-with-signed-urls" title="Permalink to this headline">¶</a></h2>
<div class="section" id="using-the-rest-endpoint">
<h3>Using the REST Endpoint<a class="headerlink" href="#using-the-rest-endpoint" title="Permalink to this headline">¶</a></h3>
<p>Signed urls allow files to be downloaded without any authorization headers.
This is important for allowing users to download from the browser, as it is
not possible to attach headers to requests made from anchor tags.</p>
<p>To initiate a download through a signed url, the client must send an authorized
request to the <code class="docutils literal notranslate"><span class="pre">/signed-url</span></code> endpoint:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/study/&lt;study_id&gt;/files/&lt;file_id&gt;<span class="o">(</span>?P/version/&lt;version_id&gt;<span class="o">)</span>
<span class="o">{</span>
    <span class="s2">&quot;url&quot;</span>: <span class="s2">&quot;/download/study/&lt;study_id&gt;/files/&lt;file_id&gt;/version/&lt;version_id&gt;?token=abc&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The authorization used to generate a signed url is like any other download,
the only difference being that a url string is returned instead of a file.</p>
<p>This endpoint will respond with a json body containing a url.
This url is identical to the standard <cite>downloadUrl</cite>, except that it has an
additional token passed as a url parameter.
This token allows the file to be downloaded without additional authorization,
but it may only be claimed once and within a very short time period.
This protects against unauthorized sharing and re-use of the file download url.</p>
</div>
<div class="section" id="using-a-graphql-mutation">
<h3>Using a GraphQL Mutation<a class="headerlink" href="#using-a-graphql-mutation" title="Permalink to this headline">¶</a></h3>
<p>Signed urls may also be obtained through the GraphQL API.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mutation downloadURL <span class="o">{</span>
  signedUrl<span class="o">(</span>studyId: <span class="s2">&quot;SD_ME0WME0W&quot;</span>, fileId: <span class="s2">&quot;SF_C9BCXNC8&quot;</span><span class="o">)</span> <span class="o">{</span>
    url
  <span class="o">}</span>
<span class="o">}</span>

<span class="o">{</span>
  <span class="s2">&quot;data&quot;</span>: <span class="o">{</span>
    <span class="s2">&quot;signedUrl&quot;</span>: <span class="o">{</span>
      <span class="s2">&quot;url&quot;</span>: <span class="s2">&quot;/download/study/SD_ME0WME0W/file/SF_C9BCXNC8/version/FV_TMMKQH14?token=lXuORIMbm0d6YzBcLQxR6FllouA&quot;</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>This mutation will return a url including the token that will allow the file
to be downloaded without further authorization.
The same authorization mechanisms are in place as in the REST endpoint.</p>
</div>
</div>
<div class="section" id="downloads-with-developer-tokens">
<h2>Downloads with Developer Tokens<a class="headerlink" href="#downloads-with-developer-tokens" title="Permalink to this headline">¶</a></h2>
<p>There is a third option to download files using developer download tokens.
These tokens are similar to signed url tokens in that they may be passed as
a url parameter or under the <cite>Authorization</cite> header using a <cite>Token</cite>
prefix, although they are capable of downloading any file and do not expire.
Developer download tokens may only be generated by an admin user and should
be kept secret.
These tokens may also be generated or deleted an anytime, in case they are
accidentally distributed or no longer needed.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="authentication.html" class="btn btn-neutral float-right" title="Authentication" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="uploads.html" class="btn btn-neutral float-left" title="Uploads" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Kids First

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>